/**
 * @author Toru Nagashima <https://github.com/mysticatea>
 * See LICENSE file in root directory for full license.
 */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a=a||self,b(a.EventSourceShim={}))})(this,function(b){"use strict";var P=String.prototype,Q=Number.isFinite;function c(a){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},c(a)}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function f(a,b,c){return b&&e(a.prototype,b),c&&e(a,c),a}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&k(a,b)}function h(a){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},h(a)}function k(a,b){return k=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},k(a,b)}function l(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function m(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:l(a)}function n(a){var b=mb.get(a);return console.assert(null!=b,"'this' is expected an Event object, but got",a),b}function a(a){return null==a.passiveListener?void(!a.event.cancelable||(a.canceled=!0,"function"==typeof a.event.preventDefault&&a.event.preventDefault())):void("undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",a.passiveListener))}function o(a,b){mb.set(this,{eventTarget:a,event:b,eventPhase:2,currentTarget:a,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:b.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});for(var c,d=Object.keys(b),e=0;e<d.length;++e)c=d[e],c in this||Object.defineProperty(this,c,p(c))}function p(a){return{get:function(){return n(this).event[a]},set:function(b){n(this).event[a]=b},configurable:!0,enumerable:!0}}function q(a){return{value:function(){var b=n(this).event;return b[a].apply(b,arguments)},configurable:!0,enumerable:!0}}function r(a,b){function c(b,c){a.call(this,b,c)}var d=Object.keys(b);if(0===d.length)return a;c.prototype=Object.create(a.prototype,{constructor:{value:c,configurable:!0,writable:!0}});for(var e,f=0;f<d.length;++f)if(e=d[f],!(e in a.prototype)){var g=Object.getOwnPropertyDescriptor(b,e),h="function"==typeof g.value;Object.defineProperty(c.prototype,e,h?q(e):p(e))}return c}function s(a){if(null==a||a===Object.prototype)return o;var b=nb.get(a);return null==b&&(b=r(s(Object.getPrototypeOf(a)),a),nb.set(a,b)),b}function t(a,b){var c=s(Object.getPrototypeOf(b));return new c(a,b)}function u(a){return n(a).immediateStopped}function v(a,b){n(a).eventPhase=b}function w(a,b){n(a).currentTarget=b}function x(a,b){n(a).passiveListener=b}function y(a){return null!==a&&"object"===c(a)}function z(a){var b=ob.get(a);if(null==b)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return b}function A(a){return{get:function(){for(var b=z(this),c=b.get(a);null!=c;){if(3===c.listenerType)return c.listener;c=c.next}return null},set:function(b){"function"==typeof b||y(b)||(b=null);for(var c=z(this),d=null,e=c.get(a);null!=e;)3===e.listenerType?null===d?null===e.next?c.delete(a):c.set(a,e.next):d.next=e.next:d=e,e=e.next;if(null!==b){var f={listener:b,listenerType:3,passive:!1,once:!1,next:null};null===d?c.set(a,f):d.next=f}},configurable:!0,enumerable:!0}}function B(a,b){Object.defineProperty(a,"on".concat(b),A(b))}function C(a){function b(){D.call(this)}b.prototype=Object.create(D.prototype,{constructor:{value:b,configurable:!0,writable:!0}});for(var c=0;c<a.length;++c)B(b.prototype,a[c]);return b}function D(){if(this instanceof D)return void ob.set(this,new Map);if(1===arguments.length&&Array.isArray(arguments[0]))return C(arguments[0]);if(0<arguments.length){for(var a=Array(arguments.length),b=0;b<arguments.length;++b)a[b]=arguments[b];return C(a)}throw new TypeError("Cannot call a class as a function")}function E(c,d){if(!1===window.navigator.onLine)return void window.addEventListener("online",function a(){window.removeEventListener("online",a),d.readyState!==b.ReadyState.CLOSED&&E(c,d)});var e={origin:"",data:"",type:"",lastEventId:null,pos:0},f=d.request=new window.XMLHttpRequest,g=!0;f.open("GET",c.url,!0),f.withCredentials=c.withCredentials,f.setRequestHeader("Accept","text/event-stream"),f.setRequestHeader("Cache-Control","no-store"),d.lastEventId&&f.setRequestHeader("Last-Event-ID",d.lastEventId),f.onprogress=function(){if(d.readyState!==b.ReadyState.CLOSED&&0!==f.status){if(g){g=!1;var h=f.status,i=f.responseURL,j=f.getResponseHeader("Content-Type");if(200===h&&null!=j&&j.toLowerCase().startsWith("text/event-stream")){var k=i?O(i):d.url;e.origin="".concat(k.protocol,"//").concat(k.host),F(c,d)}else return void H(c,d)}I(c,d,e,f.responseText),f.responseText.length>wb&&f.abort()}},f.onload=function(){d.readyState===b.ReadyState.CLOSED||0===f.status||(d.request=null,200===f.status&&G(c,d),204===f.status&&g&&H(c,d))},f.onerror=function(){d.readyState!==b.ReadyState.CLOSED&&(d.request=null,G(c,d))},f.onabort=function(){d.readyState!==b.ReadyState.CLOSED&&(d.request=null,E(c,d))},f.send()}function F(a,c){tb(function(){c.readyState!==b.ReadyState.CLOSED&&(c.readyState=b.ReadyState.OPEN,a.dispatchEvent(M("open")))}),c.additionalReconnectionTime=0}function G(a,c){tb(function(){c.readyState!==b.ReadyState.CLOSED&&(c.readyState=b.ReadyState.CONNECTING,a.dispatchEvent(M("error")))}),setTimeout(function(){tb(function(){c.readyState===b.ReadyState.CONNECTING&&E(a,c)})},c.reconnectionTime+c.additionalReconnectionTime),c.additionalReconnectionTime=vb*(c.reconnectionTime+c.additionalReconnectionTime)-c.reconnectionTime}function H(a,c){tb(function(){c.readyState!==b.ReadyState.CLOSED&&(L(c),a.dispatchEvent(M("error")))})}function I(a,b,c,d){var e;for(rb.lastIndex=c.pos;null!=(e=rb.exec(d));){c.pos=rb.lastIndex;var f=e[1],g=f.indexOf(":");if(""===f)K(a,b,c);else if(-1===g)J(b,c,f,"");else if(1<=g){var h=f.slice(0,g),i=f.slice(g+(" "===f[g+1]?2:1));J(b,c,h,i)}}}function J(a,b,c,d){switch(c.toLowerCase()){case"event":b.type=d;break;case"data":b.data+=d,b.data+="\n";break;case"id":d.includes("\0")||(b.lastEventId=d);break;case"retry":sb.test(d)&&(a.reconnectionTime=parseInt(d,10));}}function K(a,c,d){var e=d.data,f=d.type,g=d.lastEventId;if(d.data=d.type="",null!=g&&(c.lastEventId=g),""!==e){var h=N(f||"message",e.slice(0,-1),d.origin,c.lastEventId);tb(function(){c.readyState!==b.ReadyState.CLOSED&&a.dispatchEvent(h)})}}function L(a){var c=a.request;a.readyState=b.ReadyState.CLOSED,a.request=null,c&&c.abort()}function M(a){try{return new window.Event(a,{bubbles:!1,cancelable:!1})}catch(c){var b=window.document.createEvent("Event");return b.initEvent(a,!1,!1),b}}function N(a,b,c,d){try{return new window.MessageEvent(a,{bubbles:!1,cancelable:!1,data:b,lastEventId:d,origin:c,source:window})}catch(f){var e=window.document.createEvent("MessageEvent");return e.initMessageEvent(a,!1,!1,b,c,d,window),e}}function O(b){var c=window.document.createElement("a");return c.href=b,c}var R=require("./_export"),S=require("./_array-includes")(!0);R(R.P,"Array",{includes:function(a){return S(this,a,1<arguments.length?arguments[1]:void 0)}}),require("./_add-to-unscopables")("includes");var T=require("./_export"),U=require("./_string-context"),V="includes";T(T.P+T.F*require("./_fails-is-regexp")(V),"String",{includes:function(a){return!!~U(this,a,V).indexOf(a,1<arguments.length?arguments[1]:void 0)}});var W=require("./_export"),X=require("./_to-length"),Y=require("./_string-context"),Z="startsWith",$=""[Z];W(W.P+W.F*require("./_fails-is-regexp")(Z),"String",{startsWith:function(a){var b=Math.min,c=Y(this,a,Z),d=X(b(1<arguments.length?arguments[1]:void 0,c.length)),e=a+"";return c.slice(d,d+e.length)===e}});for(var _=require("./es6.array.iterator"),aa=require("./_object-keys"),ba=require("./_redefine"),ca=require("./_global"),da=require("./_hide"),ea=require("./_iterators"),fa=require("./_wks"),ga=fa("iterator"),ha=fa("toStringTag"),ia=ea.Array,ja={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},ka=aa(ja),la=0;la<ka.length;la++){var ma,na=ka[la],oa=ja[na],pa=ca[na],qa=pa&&pa.prototype;if(qa&&(qa[ga]||da(qa,ga,ia),qa[ha]||da(qa,ha,na),ea[na]=ia,oa))for(ma in _)qa[ma]||ba(qa,ma,_[ma],!0)}var ra=require("./_add-to-unscopables"),sa=require("./_iter-step"),ta=require("./_iterators"),ua=require("./_to-iobject");module.exports=require("./_iter-define")(Array,"Array",function(a,b){this._t=ua(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,sa(1)):"keys"==b?sa(0,c):"values"==b?sa(0,a[c]):sa(0,[c,a[c]])},"values"),ta.Arguments=ta.Array,ra("keys"),ra("values"),ra("entries");var va=require("./_string-at")(!0);require("./_iter-define")(String,"String",function(a){this._t=a+"",this._i=0},function(){var a,b=this._t,c=this._i;return c>=b.length?{value:void 0,done:!0}:(a=va(b,c),this._i+=a.length,{value:a,done:!1})});var wa,xa=require("./_array-methods")(0),ya=require("./_redefine"),za=require("./_meta"),Aa=require("./_object-assign"),Ba=require("./_collection-weak"),Ca=require("./_is-object"),Da=require("./_fails"),Ea=require("./_validate-collection"),Fa="WeakMap",Ga=za.getWeak,Ha=Object.isExtensible,Ia=Ba.ufstore,Ja={},Ka=function(a){return function(){return a(this,0<arguments.length?arguments[0]:void 0)}},La={get:function(a){if(Ca(a)){var b=Ga(a);return!0===b?Ia(Ea(this,Fa)).get(a):b?b[this._i]:void 0}},set:function(a,b){return Ba.def(Ea(this,Fa),a,b)}},Ma=module.exports=require("./_collection")(Fa,Ka,La,Ba,!0,!0);Da(function(){return 7!=new Ma().set((Object.freeze||Object)(Ja),7).get(Ja)})&&(wa=Ba.getConstructor(Ka,Fa),Aa(wa.prototype,La),za.NEED=!0,xa(["delete","has","get","set"],function(c){var d=Ma.prototype,e=d[c];ya(d,c,function(d,a){if(Ca(d)&&!Ha(d)){this._f||(this._f=new wa);var b=this._f[c](d,a);return"set"==c?this:b}return e.call(this,d,a)})}));var Na=require("./_global"),Oa=require("./_has"),Pa=require("./_cof"),Qa=require("./_inherit-if-required"),Ra=require("./_to-primitive"),Sa=require("./_fails"),Ta=require("./_object-gopn").f,Ua=require("./_object-gopd").f,Va=require("./_object-dp").f,Wa=require("./_string-trim").trim,Xa="Number",Ya=Na[Xa],Za=Ya,$a=Ya.prototype,_a=Pa(require("./_object-create")($a))==Xa,ab="trim"in P,bb=function(a){var b=Ra(a,!1);if("string"==typeof b&&2<b.length){b=ab?b.trim():Wa(b,3);var c,d,e,f=b.charCodeAt(0);if(43===f||45===f){if(c=b.charCodeAt(2),88===c||120===c)return NaN;}else if(48===f){switch(b.charCodeAt(1)){case 66:case 98:d=2,e=49;break;case 79:case 111:d=8,e=55;break;default:return+b;}for(var g,h=b.slice(2),j=0,k=h.length;j<k;j++)if(g=h.charCodeAt(j),48>g||g>e)return NaN;return parseInt(h,d)}}return+b};if(!Ya(" 0o1")||!Ya("0b1")||Ya("+0x1")){Ya=function(a){var b=1>arguments.length?0:a,c=this;return c instanceof Ya&&(_a?Sa(function(){$a.valueOf.call(c)}):Pa(c)!=Xa)?Qa(new Za(bb(b)),c,Ya):bb(b)};for(var cb,db=require("./_descriptors")?Ta(Za):["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY","EPSILON","isFinite","isInteger","isNaN","isSafeInteger","MAX_SAFE_INTEGER","MIN_SAFE_INTEGER","parseFloat","parseInt","isInteger"],eb=0;db.length>eb;eb++)Oa(Za,cb=db[eb])&&!Oa(Ya,cb)&&Va(Ya,cb,Ua(Za,cb));Ya.prototype=$a,$a.constructor=Ya,require("./_redefine")(Na,Xa,Ya)}var fb=require("./_export"),gb=require("./_global").isFinite;fb(fb.S,"Number",{isFinite:function(a){return"number"==typeof a&&gb(a)}});var hb=require("./_collection-strong"),ib=require("./_validate-collection"),jb="Map";module.exports=require("./_collection")(jb,function(a){return function(){return a(this,0<arguments.length?arguments[0]:void 0)}},{get:function(a){var b=hb.getEntry(ib(this,jb),a);return b&&b.v},set:function(a,b){return hb.def(ib(this,jb),0===a?0:a,b)}},hb,!0);var kb=require("./_to-object"),lb=require("./_object-keys");require("./_object-sap")("keys",function(){return function(a){return lb(kb(a))}});var mb=new WeakMap,nb=new WeakMap;o.prototype={get type(){return n(this).event.type},get target(){return n(this).eventTarget},get currentTarget(){return n(this).currentTarget},composedPath:function(){var a=n(this).currentTarget;return null==a?[]:[a]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return n(this).eventPhase},stopPropagation:function(){var a=n(this);a.stopped=!0,"function"==typeof a.event.stopPropagation&&a.event.stopPropagation()},stopImmediatePropagation:function(){var a=n(this);a.stopped=!0,a.immediateStopped=!0,"function"==typeof a.event.stopImmediatePropagation&&a.event.stopImmediatePropagation()},get bubbles(){return!!n(this).event.bubbles},get cancelable(){return!!n(this).event.cancelable},preventDefault:function(){a(n(this))},get defaultPrevented(){return n(this).canceled},get composed(){return!!n(this).event.composed},get timeStamp(){return n(this).timeStamp},get srcElement(){return n(this).eventTarget},get cancelBubble(){return n(this).stopped},set cancelBubble(a){if(a){var b=n(this);b.stopped=!0,"boolean"==typeof b.event.cancelBubble&&(b.event.cancelBubble=!0)}},get returnValue(){return!n(this).canceled},set returnValue(b){b||a(n(this))},initEvent:function(){}},Object.defineProperty(o.prototype,"constructor",{value:o,configurable:!0,writable:!0}),"undefined"!=typeof window&&"undefined"!=typeof window.Event&&(Object.setPrototypeOf(o.prototype,window.Event.prototype),nb.set(window.Event.prototype,o));var ob=new WeakMap,pb=1,qb=2;D.prototype={addEventListener:function(a,b,c){if(null!=b){if("function"!=typeof b&&!y(b))throw new TypeError("'listener' should be a function or an object.");var d=z(this),e=y(c),f=e?!!c.capture:!!c,g=f?pb:qb,h={listener:b,listenerType:g,passive:e&&!!c.passive,once:e&&!!c.once,next:null},i=d.get(a);if(void 0===i)return void d.set(a,h);for(var j=null;null!=i;){if(i.listener===b&&i.listenerType===g)return;j=i,i=i.next}j.next=h}},removeEventListener:function(a,b,c){if(null!=b)for(var d=z(this),e=y(c)?!!c.capture:!!c,f=e?pb:qb,g=null,h=d.get(a);null!=h;){if(h.listener===b&&h.listenerType===f)return void(null===g?null===h.next?d.delete(a):d.set(a,h.next):g.next=h.next);g=h,h=h.next}},dispatchEvent:function(a){if(null==a||"string"!=typeof a.type)throw new TypeError("\"event.type\" should be a string.");var b=z(this),c=a.type,d=b.get(c);if(null==d)return!0;for(var e=t(this,a),f=null;null!=d;){if(d.once?null===f?null===d.next?b.delete(c):b.set(c,d.next):f.next=d.next:f=d,x(e,d.passive?d.listener:null),"function"==typeof d.listener)try{d.listener.call(this,e)}catch(a){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(a)}else d.listenerType!==3&&"function"==typeof d.listener.handleEvent&&d.listener.handleEvent(e);if(u(e))break;d=d.next}return x(e,null),v(e,0),w(e,null),!e.defaultPrevented}},Object.defineProperty(D.prototype,"constructor",{value:D,configurable:!0,writable:!0}),"undefined"!=typeof window&&"undefined"!=typeof window.EventTarget&&Object.setPrototypeOf(D.prototype,window.EventTarget.prototype);var rb=/((?:[\0-\t\x0B\f\x0E-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)(?:\r\n|[\n\r])/g,sb=/^[0-9]+$/,tb="function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setImmediate?setImmediate:function(a){return setTimeout(a,0)},ub=4e3,vb=1.5,wb=65536;(function(a){a[a.CONNECTING=0]="CONNECTING",a[a.OPEN=1]="OPEN",a[a.CLOSED=2]="CLOSED"})(b.ReadyState||(b.ReadyState={}));var xb=function(a){function c(a,e){var f;return d(this,c),f=m(this,h(c).call(this)),f.CONNECTING=b.ReadyState.CONNECTING,f.OPEN=b.ReadyState.OPEN,f.CLOSED=b.ReadyState.CLOSED,E(l(l(f)),yb.init(l(l(f)),a,e)),f}return g(c,a),f(c,[{key:"close",value:function(){L(yb.get(this))}},{key:"url",get:function(){return yb.get(this).url.href}},{key:"withCredentials",get:function(){return yb.get(this).withCredentials}},{key:"readyState",get:function(){return yb.get(this).readyState}}]),c}(D);xb.CONNECTING=b.ReadyState.CONNECTING,xb.OPEN=b.ReadyState.OPEN,xb.CLOSED=b.ReadyState.CLOSED,B(xb.prototype,"error"),B(xb.prototype,"message"),B(xb.prototype,"open"),Object.defineProperties(xb.prototype,{url:{enumerable:!0},withCredentials:{enumerable:!0},readyState:{enumerable:!0},close:{enumerable:!0}});var yb=new(function(){function a(){d(this,a),this.map=new WeakMap}return f(a,[{key:"init",value:function(c,d,e){var f=O(d),a={url:f,request:null,reconnectionTime:ub,lastEventId:"",withCredentials:!!(e&&e.withCredentials),readyState:b.ReadyState.CONNECTING,additionalReconnectionTime:0};if(this.map.set(c,a),!f.href.startsWith(f.protocol))throw new Error("Invalid URL: ".concat(JSON.stringify(d)));return a}},{key:"get",value:function(a){if(!this.map.has(a))throw new Error("'this' reference must be a EventSource.");return this.map.get(a)}}]),a}());if(b.EventSource=xb,b.setDefaultReconnectionTime=function(a){if(!Q(a)||0>=a)throw new Error("reconnection time must be a positive number.");ub=a},b.setReconnectionTimeIncreasingRate=function(a){if(!Q(a)||1>=a)throw new Error("reconnection time's increasing rate must be greater than 1.0.");vb=a},b.setMaxBufferSize=function(a){if(!Q(a)||0>=a)throw new Error("max buffer size must be a positive number.");wb=a},Object.defineProperty(b,"__esModule",{value:!0}),"undefined"==typeof module&&"undefined"==typeof define){const a=Function("return this")();"undefined"==typeof a.EventSource&&(a.EventSource=xb)}});
//# sourceMappingURL=event-source.umd.js.map
